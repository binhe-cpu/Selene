name: Sync Upstream Releases

on:
  workflow_dispatch: {}
  schedule:
    - cron: '0 */6 * * *'

concurrency:
  group: sync-upstream-releases
  cancel-in-progress: false

# 关键：显式设置权限
permissions:
  contents: write    # 创建 releases 和上传 assets 需要
  actions: read
  checks: read

jobs:
  sync-releases:
    runs-on: ubuntu-latest
    env:
      UPSTREAM_OWNER: MoonTechLab
      UPSTREAM_REPO: Selene
      PER_PAGE: "100"
    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Install dependencies
        run: |
          sudo apt-get update -y
          sudo apt-get install -y jq curl

      - name: Sync upstream releases
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          GITHUB_REPOSITORY: ${{ github.repository }}
        run: |
          set -euxo pipefail

          UPSTREAM="${UPSTREAM_OWNER}/${UPSTREAM_REPO}"
          echo "=== 开始从 $UPSTREAM 同步到 ${GITHUB_REPOSITORY} ==="

          # 检查上游仓库
          echo "检查上游仓库状态..."
          upstream_info=$(curl -s -w "%{http_code}" -H "Authorization: token $GH_TOKEN" \
            "https://api.github.com/repos/${UPSTREAM_OWNER}/${UPSTREAM_REPO}")
          # ... 其余代码保持不变
